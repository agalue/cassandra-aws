# @author agalue@opennms.com
---
- name: 'Start Cassandra process {{ item.key }}'
  service:
    name: 'cassandra3@{{ item.key }}'
    state: started

- name: 'Wait for {{ item.key }} ({{ item.value }}) to join the cluster'
  shell: 'set -o pipefail && nodetool -u cassandra -pw cassandra status 2>/dev/null | grep {{ item.value }}'
  changed_when: False
  register: result
  until: result.stdout is regex("^UN.*")
  delay: 30
  retries: 10
